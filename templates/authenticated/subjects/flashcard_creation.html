{% extends "authenticated/authenticated_base.html" %}

{% block app_content %}
<div class="deck-view-wrapper">
    <div class="deck-big-card">
        
        <h1 class="deck-title">Create Flashcard</h1>

        <div class="side-toggle-container">
            <button class="toggle-btn active" id="btn-front" onclick="SwitchSide('front')">Front</button>
            <button class="toggle-btn" id="btn-back" onclick="SwitchSide('back')">Back</button>
        </div>

        <div class="flashcard-editor">
            <textarea id="flashcard-input" class="flashcard-textarea" placeholder="Type the front of the flashcard here..."></textarea>
        </div>

        <form id="flashcard-form" action="/flashcard_creation" method="POST" style="display: none;">
            <input type="hidden" name="DeckID" value="{{ DeckID }}">
            <input type="hidden" name="FrontContent" id="hidden-front">
            <input type="hidden" name="BackContent" id="hidden-back">
        </form>

        <div class="review-actions" style="margin-top: 30px;">
            <button type="button" class="btn" onclick="SubmitFlashcard()">Save Flashcard</button>
            <a href="/flashcard_selection?DeckID={{ DeckID }}" class="btn outline-btn cancel-btn">Cancel</a>
        </div>

    </div>
</div>

<script>
    let FrontText = "";
    let BackText = "";
    let CurrentSide = "front";

    const TextArea = document.getElementById('flashcard-input');
    const ButtonFront = document.getElementById('btn-front');
    const ButtonBack = document.getElementById('btn-back');

    function SwitchSide(TargetSide) {
        if (TargetSide === CurrentSide) return;

        if (CurrentSide === 'front') {
            FrontText = TextArea.value;
        } else {
            BackText = TextArea.value;
        }

        CurrentSide = TargetSide;

        if (CurrentSide === 'front') {
            TextArea.value = FrontText;
            TextArea.placeholder = "Type the front of the flashcard here...";
            ButtonFront.classList.add('active');
            ButtonBack.classList.remove('active');
        } else {
            TextArea.value = BackText;
            TextArea.placeholder = "Type the back (answer) of the flashcard here...";
            ButtonBack.classList.add('active');
            ButtonFront.classList.remove('active');
        }
    }

    function SubmitFlashcard() {
        if (CurrentSide === 'front') {
            FrontText = TextArea.value;
        } else {
            BackText = TextArea.value;
        }

        document.getElementById('hidden-front').value = FrontText;
        document.getElementById('hidden-back').value = BackText;

        if (FrontText.trim() === "" || BackText.trim() === "") {
            alert("Both the front and back of the flashcard must have text!");
            return;
        }

        document.getElementById('flashcard-form').submit();
    }
</script>
{% endblock %}